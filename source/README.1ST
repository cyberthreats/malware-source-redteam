[Red Team]
Windows/E-Mail Virus.
(c) 1997 The Soul Manager.

% Important %
_____________

I do not give permission to anyone to publish this virus in their Vx zine.
This means the fools who published the source to Zhengxi, 6 months after it 
was made publicly available, and kept rambling on about they were the zine 
to release the source.. they know who they are. Also, ugly children are not
permitted to read this text.

Greetings to the makers of Asterix, IKX, and IRG magazines and Virus Coders
everywhere.

% File List %
_____________

File		Description
---------------+-------------------------------------------------------
VIRUS.ASH	General Directives / Shortcuts.
CWV.ASH		Directives and Declarations for CWV Module.
CWV.ASM		Crazy Windows Virus - The virus engine.
EUDORA.ASH	Directives and Declarations for Eudora Module.
EUDORA.ASM	Routines to E-Mail the fake message and virus dropper.
LZD.ASH		Directives and Declatations for LZD Module.
LZD.ASM		Routines to de-compress LZSS compressed blocks.
VEND.ASM	Indicates end of virus, provides first generation host.
EUD_DATA.INC	Data of E-Mail message and virus dropper -(both compressed).
MAIL.MSG	Fake E-Mail message. (Amusing, Must be compressed).
K-RTEAM.EXE	Virus Dropper. (Uninfected, Must be compressed).
MAKEFILE	: virus Uruguay.6396.#10 detected.
VIRUS.EXE	First generation sample.
LZCOMP.EXE	Public Domain utility to LZSS compress files.
README.1ST	infected with MME.Ssr.18364

% Compilation %
_______________

MAKE

It's that easy. Note that TASM 5.0 with its Windows 16 bit import library is
required. Note that the order in which the objects are linked is critical -
cwv.obj must be first, and vend.obj must be last.

Note that the virus length is hard coded (at the beginning of CWV.ASM). To
obtain the required constant, simply check the offset of 'vend' in the MAP
file.

% Winging / Bitching / Moaning %
________________________________

I dont have access to the Win SDK, or any windows programming resources like
nice books. I don't have inet access either. Hence, I had to dissassemble
KRNL386.EXE and a lot of other Windows system code. Not only is this a very
inefficient way to get what you want, but it means I have no idea how 
compatible the methods used in this virus are =(. Oh well, atleast I had the
API declarations that come with Visual Basic 4.0.. Also, my machine is to
old for Win95, so i can't guarantee how compatible it is there.. it worked on
my mates machine.

% Virus Description %
_____________________

Infects NewEXE apps by inserting itself into the code segment and correcting
the Segment table, Resource table, and Gangload Area data. No new segment is
added. It also adds its own relocation items to those of the code segment.

All system calls via the Win16 Kernel API. This is achieved by obtaining the
KERNEL module reference from the NewEXE header. The INITTASK import item was
added solely to fool F/Win.

Infected applications simply infect the 16-bit kernel. If the Kernel exports
a function named 'CALLPROC32W', INITTASK is intercepted, otherwise WINEXEC is
our target. This allows for WinNT/95 compatibility.

Since the Kernel does not import itself, the relocation items for the virus
are changed from import ordinals to ptr's. This is done by getting the
addresses of the functions we need from the Kernel's entry table.

The viruses WINEXEC handler immediately passes control to the original
WINEXEC handler, and then uses the returned Module Handle to infect the file
in the background (multi-tasking).

Since NT/95 don't call WINEXEC (atleast for the 16bit Kernel) we intercept
INITTASK instead. When INITTASK is issued, we assume that a new application
has recently been executed, and we walk though the chain of Module Handles
(by using GETEXEPTR) to infect all currently loaded modules that have only
one instance running, and are applications not libraries/drivers.

The first time an application is executed in the same directory as PC-Eudora,
the virus attempts to add a message to the OUTBOX. This message is addressed
to all recipients in the Nick Names database, and is marked as 'Queued to be
Sent'. The message contains a 'good times' style virus warning hoax, and
includes an EXE files masquerading as an Anti-Virus, as its attachment. The
attached EXE file is, ofcourse, infected.